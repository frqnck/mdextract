#!/usr/bin/env node

var mdextract = require('../index');
var argv = process.argv;

var showInternal = argv.indexOf('--internal') > -1;
var json = argv.indexOf('--json') > -1;

readStdin(function (err, data) {
  var doc = mdextract(data);
  if (json) {
    console.log(JSON.stringify(doc, null, 2));
  } else {
    console.log(doc.toMarkdown({ showInternal: showInternal }));
  }
});

function readStdin(fn) {
  process.stdin.resume(); /* paused by default */
  process.stdin.setEncoding('utf8');

  var data = '';
  process.stdin.on('data', function(chunk) { data += chunk.toString(); });
  process.stdin.on('end', function() { fn(null, data); });
}
